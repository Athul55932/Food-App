import { useState, useEffect, useContext } from "react";
import { useNavigate } from "react-router-dom";
import { AuthContext } from "../contexts/AuthContext";
import RestaurantCard from "../components/RestaurantCard";

export default function RestaurantListPage() {
  const { user } = useContext(AuthContext);
  const navigate = useNavigate();
  const [restaurants, setRestaurants] = useState([]);
  const [loading, setLoading] = useState(true);
  const [theme, setTheme] = useState("light");

  useEffect(() => {
    fetch(`${process.env.REACT_APP_API_URL}/restaurants`)
        .then(res => res.json())
        .then(data => {
          setRestaurants(data);
          setLoading(false);
        })
        .catch(err => {
          console.error(err);
          setLoading(false);
        });
  }, []);

  useEffect(() => {
    document.body.style.background =
        theme === "light" ? "#f9fafb" : "#0f172a";
    document.body.style.transition = "background 0.3s ease";
  }, [theme]);

  const handleClick = (id) => {
    if (user.role === "ADMIN") {
      navigate(`/admin/restaurants/${id}`);
    } else {
      navigate(`/restaurants/${id}`);
    }
  };

  const styles = {
    container: {
      minHeight: "100vh",
      padding: "24px",
      fontFamily: "Inter, system-ui, sans-serif",
      color: theme === "light" ? "#111827" : "#f9fafb",
      transition: "color 0.3s ease",
    },
    header: {
      display: "flex",
      justifyContent: "space-between",
      alignItems: "center",
      marginBottom: "24px",
    },
    themeBtn: {
      border: "none",
      background: "transparent",
      fontSize: "20px",
      cursor: "pointer",
      transition: "transform 0.2s ease",
    },
    loading: {
      textAlign: "center",
      marginTop: "40px",
      fontSize: "16px",
      color: theme === "light" ? "#6b7280" : "#cbd5e1",
    },
    empty: {
      textAlign: "center",
      marginTop: "40px",
      fontSize: "16px",
      color: theme === "light" ? "#6b7280" : "#cbd5e1",
    },
    grid: {
      display: "grid",
      gridTemplateColumns: "repeat(auto-fill, minmax(250px, 1fr))",
      gap: "20px",
    },
  };

  if (loading) return <p style={styles.loading}>Loading restaurants...</p>;

  if (restaurants.length === 0) return <p style={styles.empty}>No restaurants available right now.</p>;

  return (
      <div style={styles.container}>
        <div style={styles.header}>
          <h2 style={{ margin: 0, color: "#6b7280" }}>üç¥ Restaurants</h2>

        </div>

        <div style={styles.grid}>
          {restaurants.map(r => (
              <RestaurantCard key={r.id} restaurant={r} onClick={() => handleClick(r.id)} />
          ))}
        </div>
      </div>
  );
}
